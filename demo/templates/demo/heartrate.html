{% extends 'demo/base.html' %}
{% load staticfiles %}
<!--SC: https://snakeycode.wordpress.com/2014/10/26/django-template-filter-for-formating-currency/-->
{% load humanize %}
<!--SC: https://docs.djangoproject.com/en/1.10/howto/custom-template-tags/ -->
<!--SC: https://djangosnippets.org/snippets/9/ -->
{% load demo_tags %}

{% block page-title %}Member Detail{% endblock %}

{% block nav_demo %}class="active"{% endblock %}
{% block nav_heartrate %}class="active"{% endblock %}

{% block page-stylesheets %}
		<link rel="stylesheet" href="{% static 'css/marquee.css' %}" />
{% endblock %}

{% block breadcrumb %}
	<li>Home</li><li>Member</li><li>Detail</li>
{% endblock %}


{% block main_content %}

{# expr member.pcp() as pcp #}

<!-- SC header row -->
<div class="row">
	<div class="col-sm-1 profile-pic">
		<!-- <br><br>
		<img src="img/avatars/4.png" alt="demo user"> -->
		<!-- Note: The activity badge color changes when clicked and resets the number to 0
		Suggestion: You may want to set a flag when this happens to tick off all checked messages / notifications -->
		<span id="activity" class="activity-dropdown">
			<!-- <i class="fa fa-user"></i>  -->
			{# <img src="{% static 'img/avatars/4.png' %}" alt="demo user"> #}
			<img src="{% static member.picture_path %}" alt="{# member.name #}" />
			<b class="badge"> 21 </b>
		</span>
		<!-- AJAX-DROPDOWN : control this dropdown height, look and feel from the LESS variable file -->
		<div class="ajax-dropdown">
			<!-- the ID links are fetched via AJAX to the ajax container "ajax-notifications" -->
			<div class="btn-group btn-group-justified" data-toggle="buttons">
				<label class="btn btn-default">
					<input type="radio" name="activity" id="{% static 'ajax/notify/mail.html' %}">
					Msgs (14) </label>
				<label class="btn btn-default">
					<input type="radio" name="activity" id="{% static 'ajax/notify/notifications.html' %}">
					notify (3) </label>
				<label class="btn btn-default">
					<input type="radio" name="activity" id="{% static 'ajax/notify/tasks.html' %}">
					Tasks (4) </label>
			</div>
			<!-- notification content -->
			<div class="ajax-notifications custom-scroll">
				<div class="alert alert-transparent">
					<h4>Click a button to show messages here</h4>
					This blank page message helps protect your privacy, or you can show the first message here automatically.
				</div>
				<i class="fa fa-lock fa-4x fa-border"></i>
			</div>
			<!-- end notification content -->
			<!-- footer: refresh area -->
			<span> Last updated on: 8/12/2016 9:43AM
				<button type="button" data-loading-text="<i class='fa fa-refresh fa-spin'></i> Loading..." class="btn btn-xs btn-default pull-right">
					<i class="fa fa-refresh"></i>
				</button> </span>
			<!-- end footer -->
		</div>
		<!-- END AJAX-DROPDOWN -->
	</div>

	<div class="col-sm-2">
		<!-- dropdown -->
		<div class="project-context hidden-xs">
			<span class="project-selector  dropdown-toggle" data-toggle="dropdown" style="text-transform: none; margin-top: -10px;">
				<h1>{{ member.first_name }}<span class="semi-bold"> {{ member.last_name }}</span>
					<i class="fa fa-angle-down"></i></h1>
			</span>
			<h1 style="margin-top: -10px;"><small>{{ member.plan_name }}</small></h1>

			<!-- Suggestion: populate this list with fetch and push technique -->
			<ul class="dropdown-menu">
				<li>
					<a href="javascript:void(0);">Primary Conditions:</a>
				</li>
				<li>
					<a href="javascript:void(0);">&nbsp;-&nbsp;Hypertension</a>
				</li>
				<li>
					<a href="javascript:void(0);">&nbsp;-&nbsp;Type 1 Diabetes (IDDM)</a>
				</li>
				<li class="divider"></li>
				<li>
					<a href="javascript:void(0);"><i class="fa fa-power-off"></i> Clear</a>
				</li>
			</ul>
			<!-- end dropdown-menu-->
		</div>
		<!-- end projects dropdown -->
	</div>

	<!-- right side of the page with the sparkline graphs -->
	<!-- sparkline col -->
	<div class="col-xs-12 col-sm-5 col-md-5 col-lg-9">
		<!-- sparks -->
		<ul id="sparks">
			<li class="sparks-info" style="min-width: 10px;">
				<div> Sex <span class="txt-color-blue">{{ member.sex }}</span></div>
			</li>
			<li class="sparks-info" style="min-width: 10px;">
				<h5> Age <span class="txt-color-blue">{{ member.age }}</span></h5>
			</li>
			<li class="sparks-info" style="min-width: 15px;">
				<h5> Height <span class="txt-color-blue">{{ member.height.value_str }}</span></h5>
			</li>
			<li class="sparks-info">
				<h5> Weight <span class="txt-color-blue">
					{% if member.weight.value_1_trend > 0 %}
						<i class="fa fa-arrow-circle-up" data-rel="bootstrap-tooltip" title="Increasing"></i>
					{% elif member.weight.value_1_trend < 0 %}
						<i class="fa fa-arrow-circle-down" data-rel="bootstrap-tooltip" title="Decreasing"></i>
					{% else %}
						<i class="fa fa-arrow-circle-right" data-rel="bootstrap-tooltip" title="Stable"></i>
					{% endif %}
					&nbsp;{{ member.weight.value_1 | floatformat:"0" }}</span>
				</h5>
					<!--100, 1877, 2500, 2577, 2000, 2100, 3000, 2700, 3631, 2471, 2700, 3631, 2471-->
				<div class="sparkline txt-color-blue hidden-mobile hidden-md hidden-sm">
					{{ member.weight.value_1_history }}
				</div>
			</li>
			<li class="sparks-info">
				<h5> BP <span class="txt-color-greenDark">
					{% if member.bp.value_1_trend > 0 %}
						<i class="fa fa-arrow-circle-up" data-rel="bootstrap-tooltip" title="Increasing"></i>
					{% elif member.bp.value_1_trend < 0 %}
						<i class="fa fa-arrow-circle-down" data-rel="bootstrap-tooltip" title="Decreasing"></i>
					{% else %}
						<i class="fa fa-arrow-circle-right" data-rel="bootstrap-tooltip" title="Stable"></i>
					{% endif %}
					&nbsp;{{ member.bp.value_str }}</span>
				</h5>
				<div class="sparkline txt-color-greenDark hidden-mobile hidden-md hidden-sm">
					{{ member.bp.value_1_history }}
				</div>
			</li>
			<li class="sparks-info">
				<h5> HR <span class="txt-color-red">
					{% if member.hr.value_1_trend > 0 %}
						<i class="fa fa-arrow-circle-up" data-rel="bootstrap-tooltip" title="Increasing"></i>
					{% elif member.hr.value_1_trend < 0 %}
						<i class="fa fa-arrow-circle-down" data-rel="bootstrap-tooltip" title="Decreasing"></i>
					{% else %}
						<i class="fa fa-arrow-circle-right" data-rel="bootstrap-tooltip" title="Stable"></i>
					{% endif %}
					&nbsp;{{ member.hr.value_1 | floatformat:"0" }}</span>
				</h5>
				<div class="sparkline txt-color-red hidden-mobile hidden-md hidden-sm">
					{{ member.hr.value_1_history }}
				</div>
			</li>
		</ul>
		<!-- end sparks -->
	</div>
	<!-- end sparkline col -->

</div>
<!-- end SC header row -->


<!-- widget grid -->
<section id="widget-grid" class="">

	<!-- SC main grid row -->
	<div class="row">

		<!-- NEW WIDGET PATIENT INFO COLUMN 1 START -->
		<article class="col-sm-12 col-md-12 col-lg-4">

			<!-- SC Flot Auto Updating Chart -->
			<!-- Widget ID (each widget will need unique ID)-->
			<div class="jarviswidget" id="wid-rt-heartrate" data-widget-editbutton="false">
				<header>
					<span class="widget-icon"> <i class="fa fa-bar-chart-o"></i> </span>
					<h2>Heartrate </h2>
				</header>
				<!-- widget div-->
				<div>
					<!-- widget content -->
					<div class="widget-body no-padding">
						<!--on/off switch-->
						<span class="demo-liveupdate-1"> <span class="onoffswitch-title">Live switch</span> <span class="onoffswitch">
						<input type="checkbox" name="start_interval" class="onoffswitch-checkbox" id="start_interval">
						<label class="onoffswitch-label" for="start_interval">
							<span class="onoffswitch-inner" data-swchon-text="ON" data-swchoff-text="OFF"></span>
							<span class="onoffswitch-switch"></span> </label> </span> </span>
						<!--on/off switch-->
						<div id="updating-chart" class="chart"></div>

						<div class="show-stat-microcharts">
							<div class="col-xs-12 col-sm-6 col-md-6 col-lg-12">

								<div class="easy-pie-chart txt-color-orangeDark" data-percent="33" data-pie-size="50">
									<span class="percent percent-sign">35</span>
								</div>
								<span class="easy-pie-title"> Steps <i class="fa fa-caret-up icon-color-bad"></i> </span>
								<ul class="smaller-stat hidden-sm pull-right">
									<li>
										<span class="label bg-color-greenLight"><i class="fa fa-caret-up"></i> 97%</span>
									</li>
									<li>
										<span class="label bg-color-blueLight"><i class="fa fa-caret-down"></i> 44%</span>
									</li>
								</ul>
								<div class="sparkline txt-color-greenLight hidden-sm hidden-md pull-right" data-sparkline-type="line" data-sparkline-height="33px" data-sparkline-width="70px" data-fill-color="transparent">
									130, 187, 250, 257, 200, 210, 300, 270, 363, 247, 270, 363, 247
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-6 col-lg-12">
								<div class="easy-pie-chart txt-color-greenLight" data-percent="78.9" data-pie-size="50">
									<span class="percent percent-sign">78.9 </span>
								</div>
								<span> <!--class="easy-pie-title"--> Distance Moved <i class="fa fa-caret-down icon-color-good"></i></span>
								<ul class="smaller-stat hidden-sm pull-right">
									<li>
										<span class="label bg-color-blueDark"><i class="fa fa-caret-up"></i> 76%</span>
									</li>
									<li>
										<span class="label bg-color-blue"><i class="fa fa-caret-down"></i> 3%</span>
									</li>
								</ul>
								<div class="sparkline txt-color-blue hidden-sm hidden-md pull-right" data-sparkline-type="line" data-sparkline-height="33px" data-sparkline-width="70px" data-fill-color="transparent">
									257, 200, 210, 300, 270, 363, 130, 187, 250, 247, 270, 363, 247
								</div>
							</div>
						</div>


					</div>
					<!-- end widget content -->
				</div>
				<!-- end widget div -->
			</div>
			<!-- end widget -->
			<!-- /SC Flot Auto Updating Chart -->

		</article>
		<!-- WIDGET PATIENT INFO COLUMN 1 END -->

	</div>
	<!-- end SC main grid row -->


</section>
<!-- end widget grid -->

{% endblock %} <!-- main content -->


<!-- copied here for reference -->
{% block js_touch %}
{% endblock %}

{% block js_smartadmin %}
		<!-- CUSTOM NOTIFICATION -->
		<script src="{% static 'js/notification/SmartNotification.min.js' %}"></script>

		<!-- JARVIS WIDGETS -->
		<script src="{% static 'js/smartwidgets/jarvis.widget.min.js' %}"></script>

		<!-- EASY PIE CHARTS -->
		<script src="{% static 'js/plugin/easy-pie-chart/jquery.easy-pie-chart.min.js' %}"></script>

		<!-- SPARKLINES -->
		<script src="{% static 'js/plugin/sparkline/jquery.sparkline.min.js' %}"></script>

		<!-- JQUERY VALIDATE -->
		<script src="{% static 'js/plugin/jquery-validate/jquery.validate.min.js' %}"></script>

		<!-- JQUERY MASKED INPUT -->
		<script src="{% static 'js/plugin/masked-input/jquery.maskedinput.min.js' %}"></script>

		<!-- JQUERY SELECT2 INPUT -->
		<script src="{% static 'js/plugin/select2/select2.min.js' %}"></script>

		<!-- JQUERY UI + Bootstrap Slider -->
		<script src="{% static 'js/plugin/bootstrap-slider/bootstrap-slider.min.js' %}"></script>
{% endblock %} <!-- js_smartadmin -->

{% block js_voice_chat %}
{% endblock %}

{% block js_page_plugins %}
		<!-- SC: dygraph -->
		<script src="{% static 'js/plugin/dygraphs/demo-data.min.js' %}"></script>
		<!-- DYGRAPH -->
		<script src="{% static 'js/plugin/dygraphs/dygraph-combined.min.js' %}"></script>
		<!-- progress bars -->
		<script src="{% static 'js/plugin/bootstrap-progressbar/bootstrap-progressbar.min.js' %}">
		</script>
		<!-- /SC: dygraph -->

		<!-- SC: flot -->
		<!-- Flot Chart Plugin: Flot Engine, Flot Resizer, Flot Tooltip -->
		<script src="{% static 'js/plugin/flot/jquery.flot.cust.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.resize.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.fillbetween.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.orderBar.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.pie.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.time.min.js' %}"></script>
		<script src="{% static 'js/plugin/flot/jquery.flot.tooltip.min.js' %}"></script>
		<!-- /SC: flot -->


		<!-- SC: news ticker -->
		<!-- https://github.com/conradfeyt/Simple-Marquee -->
		<!-- // <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> -->
		<script type="text/javascript" src="{% static 'js/marquee.js' %}"></script>
		<script>
			$(function (){
				$('.simple-marquee-container').SimpleMarquee();
			});
		</script>
		<!-- /SC: news ticker -->

{% endblock %} <!-- js_page_plugins -->

{% block js_doc_ready %}
    <!-- DOCUMENT READY FUNCTION -->
    <script type="text/javascript">
		// PAGE RELATED DECLARATIONS

        /* SC: flot */
		/* chart colors default */
		var $chrt_border_color = "#efefef";
		var $chrt_grid_color = "#DDD"
		var $chrt_main = "#E24913";
		/* red       */
		var $chrt_second = "#6595b4";
		/* blue      */
		var $chrt_third = "#FF9F01";
		/* orange    */
		var $chrt_fourth = "#7e9d3a";
		/* green     */
		var $chrt_fifth = "#BD362F";
		/* dark red  */
		var $chrt_mono = "#000";
        /* /SC: flot */

		$(document).ready(function() {
			/* DO NOT REMOVE : GLOBAL FUNCTIONS!
			 *
			 * pageSetUp(); WILL CALL THE FOLLOWING FUNCTIONS
			 *
			 * // activate tooltips
			 * $("[rel=tooltip]").tooltip();
			 *
			 * // activate popovers
			 * $("[rel=popover]").popover();
			 *
			 * // activate popovers with hover states
			 * $("[rel=popover-hover]").popover({ trigger: "hover" });
			 *
			 * // activate inline charts
			 * runAllCharts();
			 *
			 * // setup widgets
			 * setup_widgets_desktop();
			 *
			 * // run form elements
			 * runAllForms();
			 *
			 ********************************
			 *
			 * pageSetUp() is needed whenever you load a page.
			 * It initializes and checks for all basic elements of the page
			 * and makes rendering easier.
			 *
			 */

			pageSetUp();

			/*
			 * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
			 * eg alert("my home function");
			 *
			 * var pagefunction = function() {
			 *   ...
			 * }
			 * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
			 *
			 * TO LOAD A SCRIPT:
			 * var pagefunction = function (){
			 *  loadScript(".../plugin.js", run_after_loaded);
			 * }
			 *
			 * OR
			 *
			 * loadScript(".../plugin.js", run_after_loaded);
			 */
			/* SC: progress bar */
			// Fill all progress bars with animation
			$('.progress-bar').progressbar({
				display_text : 'fill'
			});
			// Progress Part
    		$('.jsProgressPart').progressbar({display_text: 'fill', use_percentage: false});
			/* /SC: progress bar */

			/*
			* ACCORDION
			*/
			//jquery accordion

		     var accordionIcons = {
		         header: "fa fa-plus",    // custom icon class
		         activeHeader: "fa fa-minus" // custom icon class
		     };

			$("#accordion").accordion({
				autoHeight : false,
				heightStyle : "content",
				collapsible : true,
				animate : 300,
				icons: accordionIcons,
				header : "h4",
			})

			/* SC: DyGraph */
			// SC data is in file js\plugin\dygraphs\demo-data.min.js. Search for data_temp.  Includes HR,RR / NY,SF trend definitions.
			g1 = new Dygraph(document.getElementById("noroll"), data_temp, {
				customBars : true,
				title : 'Daily Average Heartrate and Respiration',
				ylabel : 'BPM / RPM',
				legend : 'always',
				labelsDivStyles : {
					'textAlign' : 'right'
				},
				showRangeSelector : true
			});

			// g2 = new Dygraph(document.getElementById("roll14"), data_temp, {
			// 	rollPeriod : 14,
			// 	showRoller : true,
			// 	customBars : true,
			// 	ylabel : 'Temperature (F)',
			// 	legend : 'always',
			// 	labelsDivStyles : {
			// 		'textAlign' : 'right'
			// 	},
			// 	showRangeSelector : true,
			// 	rangeSelectorHeight : 30,
			// 	rangeSelectorPlotStrokeColor : 'yellow',
			// 	rangeSelectorPlotFillColor : 'lightyellow'
			// });
			/* /SC: Dygraph */

			/* SC: flot */
			/* sales chart */

			if ($("#saleschart").length) {
				var d = [[1196463600000, 0], [1196550000000, 0], [1196636400000, 0], [1196722800000, 77], [1196809200000, 3636], [1196895600000, 3575], [1196982000000, 2736], [1197068400000, 1086], [1197154800000, 676], [1197241200000, 1205], [1197327600000, 906], [1197414000000, 710], [1197500400000, 639], [1197586800000, 540], [1197673200000, 435], [1197759600000, 301], [1197846000000, 575], [1197932400000, 481], [1198018800000, 591], [1198105200000, 608], [1198191600000, 459], [1198278000000, 234], [1198364400000, 1352], [1198450800000, 686], [1198537200000, 279], [1198623600000, 449], [1198710000000, 468], [1198796400000, 392], [1198882800000, 282], [1198969200000, 208], [1199055600000, 229], [1199142000000, 177], [1199228400000, 374], [1199314800000, 436], [1199401200000, 404], [1199487600000, 253], [1199574000000, 218], [1199660400000, 476], [1199746800000, 462], [1199833200000, 500], [1199919600000, 700], [1200006000000, 750], [1200092400000, 600], [1200178800000, 500], [1200265200000, 900], [1200351600000, 930], [1200438000000, 1200], [1200524400000, 980], [1200610800000, 950], [1200697200000, 900], [1200783600000, 1000], [1200870000000, 1050], [1200956400000, 1150], [1201042800000, 1100], [1201129200000, 1200], [1201215600000, 1300], [1201302000000, 1700], [1201388400000, 1450], [1201474800000, 1500], [1201561200000, 546], [1201647600000, 614], [1201734000000, 954], [1201820400000, 1700], [1201906800000, 1800], [1201993200000, 1900], [1202079600000, 2000], [1202166000000, 2100], [1202252400000, 2200], [1202338800000, 2300], [1202425200000, 2400], [1202511600000, 2550], [1202598000000, 2600], [1202684400000, 2500], [1202770800000, 2700], [1202857200000, 2750], [1202943600000, 2800], [1203030000000, 3245], [1203116400000, 3345], [1203202800000, 3000], [1203289200000, 3200], [1203375600000, 3300], [1203462000000, 3400], [1203548400000, 3600], [1203634800000, 3700], [1203721200000, 3800], [1203807600000, 4000], [1203894000000, 4500]];

				for (var i = 0; i < d.length; ++i)
					d[i][0] += 60 * 60 * 1000;

				function weekendAreas(axes) {
					var markings = [];
					var d = new Date(axes.xaxis.min);
					// go to the first Saturday
					d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7))
					d.setUTCSeconds(0);
					d.setUTCMinutes(0);
					d.setUTCHours(0);
					var i = d.getTime();
					do {
						// when we don't set yaxis, the rectangle automatically
						// extends to infinity upwards and downwards
						markings.push({
							xaxis : {
								from : i,
								to : i + 2 * 24 * 60 * 60 * 1000
							}
						});
						i += 7 * 24 * 60 * 60 * 1000;
					} while (i < axes.xaxis.max);

					return markings;
				}

				var options = {
					xaxis : {
						mode : "time",
						tickLength : 5
					},
					series : {
						lines : {
							show : true,
							lineWidth : 1,
							fill : true,
							fillColor : {
								colors : [{
									opacity : 0.1
								}, {
									opacity : 0.15
								}]
							}
						},
						//points: { show: true },
						shadowSize : 0
					},
					selection : {
						mode : "x"
					},
					grid : {
						hoverable : true,
						clickable : true,
						tickColor : $chrt_border_color,
						borderWidth : 0,
						borderColor : $chrt_border_color,
					},
					tooltip : true,
					tooltipOpts : {
						content : "Your sales for <b>%x</b> was <span>$%y</span>",
						dateFormat : "%y-%0m-%0d",
						defaultTheme : false
					},
					colors : [$chrt_second],

				};

				var plot = $.plot($("#saleschart"), [d], options);
			};

			/* end sales chart */

			/* Sin chart */

			if ($("#sin-chart").length) {
				var sin = [], cos = [];
				for (var i = 0; i < 16; i += 0.5) {
					sin.push([i, Math.sin(i)]);
					cos.push([i, Math.cos(i)]);
				}

				var plot = $.plot($("#sin-chart"), [{
					data : sin,
					label : "sin(x)"
				}, {
					data : cos,
					label : "cos(x)"
				}], {
					series : {
						lines : {
							show : true
						},
						points : {
							show : true
						}
					},
					grid : {
						hoverable : true,
						clickable : true,
						tickColor : $chrt_border_color,
						borderWidth : 0,
						borderColor : $chrt_border_color,
					},
					tooltip : true,
					tooltipOpts : {
						//content : "Value <b>$x</b> Value <span>$y</span>",
						defaultTheme : false
					},
					colors : [$chrt_second, $chrt_fourth],
					yaxis : {
						min : -1.1,
						max : 1.1
					},
					xaxis : {
						min : 0,
						max : 15
					}
				});

				$("#sin-chart").bind("plotclick", function(event, pos, item) {
					if (item) {
						$("#clickdata").text("You clicked point " + item.dataIndex + " in " + item.series.label + ".");
						plot.highlight(item.series, item.datapoint);
					}
				});
			}

			/* end sin chart */

			/* bar chart */

			if ($("#bar-chart").length) {

				var data1 = [];
				for (var i = 0; i <= 12; i += 1)
					data1.push([i, parseInt(Math.random() * 30)]);

				var data2 = [];
				for (var i = 0; i <= 12; i += 1)
					data2.push([i, parseInt(Math.random() * 30)]);

				var data3 = [];
				for (var i = 0; i <= 12; i += 1)
					data3.push([i, parseInt(Math.random() * 30)]);

				var ds = new Array();

				ds.push({
					data : data1,
					bars : {
						show : true,
						barWidth : 0.2,
						order : 1,
					}
				});
				ds.push({
					data : data2,
					bars : {
						show : true,
						barWidth : 0.2,
						order : 2
					}
				});
				ds.push({
					data : data3,
					bars : {
						show : true,
						barWidth : 0.2,
						order : 3
					}
				});

				//Display graph
				$.plot($("#bar-chart"), ds, {
					colors : [$chrt_second, $chrt_fourth, "#666", "#BBB"],
					grid : {
						show : true,
						hoverable : true,
						clickable : true,
						tickColor : $chrt_border_color,
						borderWidth : 0,
						borderColor : $chrt_border_color,
					},
					legend : true,
					tooltip : true,
					tooltipOpts : {
						content : "<b>%x</b> = <span>%y</span>",
						defaultTheme : false
					}

				});

			}
			/* end bar chart */

			/* bar-chart-h */
			if ($("#bar-chart-h").length) {
				//Display horizontal graph
				var d1_h = [];
				for (var i = 0; i <= 3; i += 1)
					d1_h.push([parseInt(Math.random() * 30), i]);

				var d2_h = [];
				for (var i = 0; i <= 3; i += 1)
					d2_h.push([parseInt(Math.random() * 30), i]);

				var d3_h = [];
				for (var i = 0; i <= 3; i += 1)
					d3_h.push([parseInt(Math.random() * 30), i]);

				var ds_h = new Array();
				ds_h.push({
					data : d1_h,
					bars : {
						horizontal : true,
						show : true,
						barWidth : 0.2,
						order : 1,
					}
				});
				ds_h.push({
					data : d2_h,
					bars : {
						horizontal : true,
						show : true,
						barWidth : 0.2,
						order : 2
					}
				});
				ds_h.push({
					data : d3_h,
					bars : {
						horizontal : true,
						show : true,
						barWidth : 0.2,
						order : 3
					}
				});

				// display graph
				$.plot($("#bar-chart-h"), ds_h, {
					colors : [$chrt_second, $chrt_fourth, "#666", "#BBB"],
					grid : {
						show : true,
						hoverable : true,
						clickable : true,
						tickColor : $chrt_border_color,
						borderWidth : 0,
						borderColor : $chrt_border_color,
					},
					legend : true,
					tooltip : true,
					tooltipOpts : {
						content : "<b>%x</b> = <span>%y</span>",
						defaultTheme : false
					}
				});

			}
			/* end bar-chart-h

			 /* fill chart */
			if ($("#fill-chart").length) {
				var males = {
					'15%' : [[2, 88.0], [3, 93.3], [4, 102.0], [5, 108.5], [6, 115.7], [7, 115.6], [8, 124.6], [9, 130.3], [10, 134.3], [11, 141.4], [12, 146.5], [13, 151.8], [14, 159.9], [15, 165.4], [16, 167.8], [17, 168.7], [18, 169.5], [19, 168.0]],
					'90%' : [[2, 96.8], [3, 105.2], [4, 113.9], [5, 120.8], [6, 127.0], [7, 133.1], [8, 139.1], [9, 143.9], [10, 151.3], [11, 161.1], [12, 164.8], [13, 173.5], [14, 179.0], [15, 182.0], [16, 186.9], [17, 185.2], [18, 186.3], [19, 186.6]],
					'25%' : [[2, 89.2], [3, 94.9], [4, 104.4], [5, 111.4], [6, 117.5], [7, 120.2], [8, 127.1], [9, 132.9], [10, 136.8], [11, 144.4], [12, 149.5], [13, 154.1], [14, 163.1], [15, 169.2], [16, 170.4], [17, 171.2], [18, 172.4], [19, 170.8]],
					'10%' : [[2, 86.9], [3, 92.6], [4, 99.9], [5, 107.0], [6, 114.0], [7, 113.5], [8, 123.6], [9, 129.2], [10, 133.0], [11, 140.6], [12, 145.2], [13, 149.7], [14, 158.4], [15, 163.5], [16, 166.9], [17, 167.5], [18, 167.1], [19, 165.3]],
					'mean' : [[2, 91.9], [3, 98.5], [4, 107.1], [5, 114.4], [6, 120.6], [7, 124.7], [8, 131.1], [9, 136.8], [10, 142.3], [11, 150.0], [12, 154.7], [13, 161.9], [14, 168.7], [15, 173.6], [16, 175.9], [17, 176.6], [18, 176.8], [19, 176.7]],
					'75%' : [[2, 94.5], [3, 102.1], [4, 110.8], [5, 117.9], [6, 124.0], [7, 129.3], [8, 134.6], [9, 141.4], [10, 147.0], [11, 156.1], [12, 160.3], [13, 168.3], [14, 174.7], [15, 178.0], [16, 180.2], [17, 181.8], [18, 181.3], [19, 182.5]],
					'85%' : [[2, 96.2], [3, 103.8], [4, 111.8], [5, 119.6], [6, 125.6], [7, 131.5], [8, 138.0], [9, 143.3], [10, 149.3], [11, 159.8], [12, 162.5], [13, 171.3], [14, 177.5], [15, 180.2], [16, 183.8], [17, 183.4], [18, 183.5], [19, 185.5]],
					'50%' : [[2, 91.9], [3, 98.2], [4, 106.8], [5, 114.6], [6, 120.8], [7, 125.2], [8, 130.3], [9, 137.1], [10, 141.5], [11, 149.4], [12, 153.9], [13, 162.2], [14, 169.0], [15, 174.8], [16, 176.0], [17, 176.8], [18, 176.4], [19, 177.4]]
				};

				var females = {
					'15%' : [[2, 84.8], [3, 93.7], [4, 100.6], [5, 105.8], [6, 113.3], [7, 119.3], [8, 124.3], [9, 131.4], [10, 136.9], [11, 143.8], [12, 149.4], [13, 151.2], [14, 152.3], [15, 155.9], [16, 154.7], [17, 157.0], [18, 156.1], [19, 155.4]],
					'90%' : [[2, 95.6], [3, 104.1], [4, 111.9], [5, 119.6], [6, 127.6], [7, 133.1], [8, 138.7], [9, 147.1], [10, 152.8], [11, 161.3], [12, 166.6], [13, 167.9], [14, 169.3], [15, 170.1], [16, 172.4], [17, 169.2], [18, 171.1], [19, 172.4]],
					'25%' : [[2, 87.2], [3, 95.9], [4, 101.9], [5, 107.4], [6, 114.8], [7, 121.4], [8, 126.8], [9, 133.4], [10, 138.6], [11, 146.2], [12, 152.0], [13, 153.8], [14, 155.7], [15, 158.4], [16, 157.0], [17, 158.5], [18, 158.4], [19, 158.1]],
					'10%' : [[2, 84.0], [3, 91.9], [4, 99.2], [5, 105.2], [6, 112.7], [7, 118.0], [8, 123.3], [9, 130.2], [10, 135.0], [11, 141.1], [12, 148.3], [13, 150.0], [14, 150.7], [15, 154.3], [16, 153.6], [17, 155.6], [18, 154.7], [19, 153.1]],
					'mean' : [[2, 90.2], [3, 98.3], [4, 105.2], [5, 112.2], [6, 119.0], [7, 125.8], [8, 131.3], [9, 138.6], [10, 144.2], [11, 151.3], [12, 156.7], [13, 158.6], [14, 160.5], [15, 162.1], [16, 162.9], [17, 162.2], [18, 163.0], [19, 163.1]],
					'75%' : [[2, 93.2], [3, 101.5], [4, 107.9], [5, 116.6], [6, 122.8], [7, 129.3], [8, 135.2], [9, 143.7], [10, 148.7], [11, 156.9], [12, 160.8], [13, 163.0], [14, 165.0], [15, 165.8], [16, 168.7], [17, 166.2], [18, 167.6], [19, 168.0]],
					'85%' : [[2, 94.5], [3, 102.8], [4, 110.4], [5, 119.0], [6, 125.7], [7, 131.5], [8, 137.9], [9, 146.0], [10, 151.3], [11, 159.9], [12, 164.0], [13, 166.5], [14, 167.5], [15, 168.5], [16, 171.5], [17, 168.0], [18, 169.8], [19, 170.3]],
					'50%' : [[2, 90.2], [3, 98.1], [4, 105.2], [5, 111.8], [6, 118.2], [7, 125.6], [8, 130.5], [9, 138.3], [10, 143.7], [11, 151.4], [12, 156.7], [13, 157.7], [14, 161.0], [15, 162.0], [16, 162.8], [17, 162.2], [18, 162.8], [19, 163.3]]
				};

				var dataset = [{
					label : 'female mean',
					data : females['mean'],
					lines : {
						show : true
					},
					color : "rgb(255,50,50)"
				}, {
					id : 'f15%',
					data : females['15%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : false
					},
					color : "rgb(255,50,50)"
				}, {
					id : 'f25%',
					data : females['25%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.2
					},
					color : "rgb(255,50,50)",
					fillBetween : 'f15%'
				}, {
					id : 'f50%',
					data : females['50%'],
					lines : {
						show : true,
						lineWidth : 0.5,
						fill : 0.4,
						shadowSize : 0
					},
					color : "rgb(255,50,50)",
					fillBetween : 'f25%'
				}, {
					id : 'f75%',
					data : females['75%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.4
					},
					color : "rgb(255,50,50)",
					fillBetween : 'f50%'
				}, {
					id : 'f85%',
					data : females['85%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.2
					},
					color : "rgb(255,50,50)",
					fillBetween : 'f75%'
				}, {
					label : 'male mean',
					data : males['mean'],
					lines : {
						show : true
					},
					color : "rgb(50,50,255)"
				}, {
					id : 'm15%',
					data : males['15%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : false
					},
					color : "rgb(50,50,255)"
				}, {
					id : 'm25%',
					data : males['25%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.2
					},
					color : "rgb(50,50,255)",
					fillBetween : 'm15%'
				}, {
					id : 'm50%',
					data : males['50%'],
					lines : {
						show : true,
						lineWidth : 0.5,
						fill : 0.4,
						shadowSize : 0
					},
					color : "rgb(50,50,255)",
					fillBetween : 'm25%'
				}, {
					id : 'm75%',
					data : males['75%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.4
					},
					color : "rgb(50,50,255)",
					fillBetween : 'm50%'
				}, {
					id : 'm85%',
					data : males['85%'],
					lines : {
						show : true,
						lineWidth : 0,
						fill : 0.2
					},
					color : "rgb(50,50,255)",
					fillBetween : 'm75%'
				}]

				$.plot($("#fill-chart"), dataset, {

					xaxis : {
						tickDecimals : 0
					},

					yaxis : {
						tickFormatter : function(v) {
							return v + " cm";
						}
					},

				});
			}
			/* end fill chart */

			/* pie chart */
			if ($('#pie-chart').length) {

				var data_pie = [];
				var series = Math.floor(Math.random() * 10) + 1;
				for (var i = 0; i < series; i++) {
					data_pie[i] = {
						label : "Series" + (i + 1),
						data : Math.floor(Math.random() * 100) + 1
					}
				}

				$.plot($("#pie-chart"), data_pie, {
					series : {
						pie : {
							show : true,
							innerRadius : 0.5,
							radius : 1,
							label : {
								show : false,
								radius : 2 / 3,
								formatter : function(label, series) {
									return '<div style="font-size:11px;text-align:center;padding:4px;color:white;">' + label + '<br/>' + Math.round(series.percent) + '%</div>';
								},
								threshold : 0.1
							}
						}
					},
					legend : {
						show : true,
						noColumns : 1, // number of colums in legend table
						labelFormatter : null, // fn: string -> string
						labelBoxBorderColor : "#000", // border color for the little label boxes
						container : null, // container (as jQuery object) to put legend in, null means default on top of graph
						position : "ne", // position of default legend container within plot
						margin : [5, 10], // distance from grid edge to default legend container within plot
						backgroundColor : "#efefef", // null means auto-detect
						backgroundOpacity : 1 // set to 0 to avoid background
					},
					grid : {
						hoverable : true,
						clickable : true
					},
				});

			}
			/* end pie chart */

			/* site stats chart */
			if ($("#site-stats").length) {

				var pageviews = [[1, 75], [3, 87], [4, 93], [5, 127], [6, 116], [7, 137], [8, 135], [9, 130], [10, 167], [11, 169], [12, 179], [13, 185], [14, 176], [15, 180], [16, 174], [17, 193], [18, 186], [19, 177], [20, 153], [21, 149], [22, 130], [23, 100], [24, 50]];
				var visitors = [[1, 65], [3, 50], [4, 73], [5, 100], [6, 95], [7, 103], [8, 111], [9, 97], [10, 125], [11, 100], [12, 95], [13, 141], [14, 126], [15, 131], [16, 146], [17, 158], [18, 160], [19, 151], [20, 125], [21, 110], [22, 100], [23, 85], [24, 37]];
				//console.log(pageviews)
				var plot = $.plot($("#site-stats"), [{
					data : pageviews,
					label : "Your pageviews"
				}, {
					data : visitors,
					label : "Site visitors"
				}], {
					series : {
						lines : {
							show : true,
							lineWidth : 1,
							fill : true,
							fillColor : {
								colors : [{
									opacity : 0.1
								}, {
									opacity : 0.15
								}]
							}
						},
						points : {
							show : true
						},
						shadowSize : 0
					},
					xaxis : {
						mode : "time",
						tickLength : 10
					},

					yaxes : [{
						min : 20,
						tickLength : 5
					}],
					grid : {
						hoverable : true,
						clickable : true,
						tickColor : $chrt_border_color,
						borderWidth : 0,
						borderColor : $chrt_border_color,
					},
					tooltip : true,
					tooltipOpts : {
						content : "%s for <b>%x:00 hrs</b> was %y",
						dateFormat : "%y-%0m-%0d",
						defaultTheme : false
					},
					colors : [$chrt_main, $chrt_second],
					xaxis : {
						ticks : 15,
						tickDecimals : 2
					},
					yaxis : {
						ticks : 15,
						tickDecimals : 0
					},
				});

			}
			/* end site stats */

			/* updating chart */
			if ($('#XXXupdating-chart').length) {

				var updateInterval = 1000;
				var plotDuration = 30 * updateInterval;
				var queryOffset = 10 * updateInterval;
				var dataOffset = 5 * updateInterval;
				var plotMax, plotMin;
				var queryMax, queryMin, dataMax;
				var plotData = [];

					plotMax = (new Date($.now())).getTime();
					plotMin = plotMax - plotDuration;
					queryMax = plotMax - queryOffset;
					queryMin = (plotData.length > 0) ? plotData[plotData.length - 1][0] : plotMin;

				getFitbitData();

				function getFitbitData() {
				    console.log("starting");  // sanity check
				    var jdata = []
				    var t, val
					$.getJSON("/fitbit/heartrate/get", {
					        member_id: {{ member.id }},
					        from: queryMin,
					        to: queryMax
					     },
						function(json){
						    console.log(json);  // sanity check
						  //   $.each(json, function (index, value) {
						  //       // console.log("index: " + index + " value: " + value + " time: " + value.record_date + " value: " + value.value);
						  //       // console.log("index: " + index + " time: " + (new Date(value.record_date)).getTime() + " value: " + value.value);
						  //       t = (new Date(value.record_date)).getTime();
						  //       val = value.value
								// jdata.push([t, val]);
						  //   });
				    // 		queryData = jdata
				    		// console.log("query data: " + queryData);  // sanity check
					        // console.log("queryData: queryData.length: " + queryData.length + " queryDataMin: " + (new Date(queryData[0][0])).toLocaleTimeString() + " queryDataMax: " + (new Date(queryData[queryData.length-1][0])).toLocaleTimeString());
						});
					// call is asynchronous so data is not populated by this point
				    return;
				};

			}
			/* end site stats */

			/* updating chart */
			if ($('#updating-chart').length) {

				var initialRun = true;
				var $on = false;
				var ajaxComplete = false;
				var updateInterval = 1000;
				var plotDuration = 30 * updateInterval;
				var queryOffset = 5 * updateInterval;
				var dataOffset = 15 * updateInterval;
				var member_id = {{ member.id }};

				var plotMax, plotMin;
				var queryMax, queryMin, dataMax;
				var plotData = [];
				var queryData = [];
				var plotOptions;
				var plot;

				// setup plot
				function getOptions() {
					var options = {
						yaxis : {
							min : 0, max : 100
						},
						xaxis: {
							min: plotMin, max: plotMax,
							mode: "time", timezone: "browser"
						},
						colors : [$chrt_fourth],
						series : {
							lines : {
								lineWidth : 1,
								fill : true,
								fillColor : {
									colors : [{
										opacity : 0.4 }, { opacity : 0 }]
								},
								steps : false
							}
						}
					};
					return options;
				};

				function getRandomData() {
					var x = 0
					var data = []
					while (x < queryMax) {
						var prevx = data.length > 0 ? data[data.length - 1][0] : queryMin;
						x = prevx + updateInterval;
						var prevy = data.length > 0 ? data[data.length - 1][1] : 50;
						var y = prevy + Math.random() * 10 - 5;
						if (y < 0)
							y = 0;
						if (y > 100)
							y = 100;
						data.push([x, y]);
					}
					return data;
				}

				function getFitbitData() {
				    var jdata = []
				    var t, val
					$.getJSON("/fitbit/heartrate/get", {
					        member_id: member_id,
					        from: (new Date(queryMin)).toISOString(),
					        to: (new Date(queryMax)).toISOString() },
						function(json){
						    // console.log(json);  // sanity check
						    $.each(json, function (index, value) {
						        t = (new Date(value.record_date)).getTime();
						        val = value.value;
								jdata.push([t, val]);
						    });
				    		queryData = jdata;
							ajaxComplete = true;
							console.log("queryMin: " + (new Date(queryMin)).toLocaleTimeString() + " queryMax: " + (new Date(queryMax)).toLocaleTimeString() + " queryData.length: " + queryData.length);
							// console.log("queryData: queryData.length: " + queryData.length + " queryDataMin: " + (new Date(queryData[0][0])).toLocaleTimeString() + " queryDataMax: " + (new Date(queryData[queryData.length-1][0])).toLocaleTimeString());
						});
					// call is asynchronous so data is not populated by this point
				    return;
				};

				function resetChart() {
					// update the query max time
					plotMax = (new Date($.now())).getTime();
					plotMin = plotMax - plotDuration;
					queryMax = plotMax - queryOffset;
					queryMin = (plotData.length > 0) ? plotData[plotData.length - 1][0] : plotMin;
					dataMax = queryMax - dataOffset;

					getFitbitData();
					plotOptions = getOptions();
					plot = $.plot($("#updating-chart"), [plotData], plotOptions);
					return;
				}

				function getPlotData() {
					while (queryData.length > 1 && queryData[0][0] < dataMax) {
						plotData.push(queryData[0])
						queryData = queryData.slice(1);
					}
					while (plotData.length > 0 && plotData[0][0] < plotMin - updateInterval) {
						plotData = plotData.slice(1);
					}
		            if (queryData.length == 1) {
						resetChart();
						plot.setData([plotData]);
		            }
		            return plotData;
				}

				/* live switch */
				$('input[type="checkbox"]#start_interval').click(function() {
					if ($(this).prop('checked')) {
						$on = true;
						resetChart();
						update();
					} else {
						clearInterval(updateInterval);
						$on = false;
					}
				});

				function update() {
					if ($on == true) {
						dataMax += updateInterval;
						plot.setData([getPlotData()]);
						// console.log("update: " + plotData.length)
						if (plotData.length > 0 && initialRun) {
							$on = false;
							initialRun = false;
						}
						if (plotData.length == 0 && ajaxComplete) {
							$on = false;
							console.log("Query returned no data. user_id:" + member_id + " from: " + (new Date(queryMin)).toLocaleTimeString() + " to: " + (new Date(queryMax)).toLocaleTimeString());
							alert("Query returned no data. user_id:" + member_id + " from: " + (new Date(queryMin)).toLocaleTimeString() + " to: " + (new Date(queryMax)).toLocaleTimeString());
						}
						plot.draw();
						setTimeout(update, updateInterval);
					} else {
						clearInterval(updateInterval)
					}
				}

				resetChart();
				plot.setData([getPlotData()]);
				plot.draw();
				if (initialRun) {
					$on = true
					update();
				}
			}
			/*end updating chart*/
			/* end flot charts */
			/* SC: flot */
        })
    </script>
    <!-- END DOCUMENT READY FUNCTION -->
{% endblock %} <!-- js_doc_ready -->
